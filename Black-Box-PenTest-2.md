# Black Box Pen Test 2 - RCM 8/25/2021
# INE 
# Scenario

You have been engaged in a Black-box Penetration Test (172.16.64.0/24 range). Your goal is to read the flag file on each machine. On some of them, you will be required to exploit a remote code execution vulnerability in order to read the flag.

# Goals 
- Discover all the machines on the network
- Read all flag files (One per machine, stored on the filesystem or within a database)
- Obtain a reverse shell at least on 172.16.64.92

# What You Will Learn 
- Taking advantage of DNS and virtual hosts
- Bypassing client-side access controls
- Abusing unrestricted file upload to achieve remote code execution

# Recommended tools
- Dirb
- Metasploit framework (recommended version 5)
- Nmap
- Sqlmap
- BurpSuite
- Text editor
---

# Procedures

1. Perform nmap discovery scan to identify alive hosts on the network. 

`nmap -sn 172.16.64.0/24`

Results:

```
Nmap scan report for 172.16.64.10
Host is up (0.000035s latency).
Nmap scan report for 172.16.64.81
Host is up (0.083s latency).
Nmap scan report for 172.16.64.91
Host is up (0.083s latency).
Nmap scan report for 172.16.64.92
Host is up (0.079s latency).
Nmap scan report for 172.16.64.166
Host is up (0.084s latency).
Nmap done: 256 IP addresses (5 hosts up) scanned in 3.45 seconds
```                                                                     


2. Perform nmap service version scan, and OS detection scan.

`sudo nmap -sS -sV -v 172.16.64.10,81,91,92,166`

Results: 

![nmap_scan](https://user-images.githubusercontent.com/76081641/130802443-dfd64423-5305-4b88-a9ac-322cb9df43b6.png)

Begin with `172.16.64.166`

Recalling nmap scan.
```
PORT     STATE SERVICE VERSION
2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
8080/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
MAC Address: 00:50:56:A0:35:13 (VMware)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

![webpage](https://user-images.githubusercontent.com/76081641/130827211-d367aef0-3c64-4a98-926d-616dc2865a2e.png)

Intercepting requests with Burp Proxy and can see a list of users for the site.
Users: Elizabeth, Tara, Becky, Randy, Pablo, Bessie, Gerardo, Sabrina.

![users](https://user-images.githubusercontent.com/76081641/130827474-5bb12863-a7a9-4a04-a67b-4b294813ac71.png)

Attempting to connect to ssh over port 2222 as root.

`ssh root@172.16.64.199 -p 2222` and discovered what the default password is= CHANGEME

![image](https://user-images.githubusercontent.com/76081641/130828383-0749df64-42da-4da4-ad73-c001e7bbf9c6.png)

Attempt to log in with usernames found from Burp Proxy.

`ssh sabrina@172.16.64.166 -p 2222`

![image](https://user-images.githubusercontent.com/76081641/130828716-09b236a7-1e2c-4c81-8ea2-9e857ba20ece.png)

and we're in!

![image](https://user-images.githubusercontent.com/76081641/130828853-86310123-ca06-475e-880e-1914456660ef.png)

Gathering information to assist with exploiting other machines.

Hosts.bak file.
![hosts.bak](https://user-images.githubusercontent.com/76081641/130829630-d40d1721-3412-4c28-ac07-43cc131b40e3.png)

---

Use Virtual Hosts to attack 172.16.64.81.

Recalling nmap scan:

```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
MAC Address: 00:50:56:A0:AD:CA (VMware)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
Add hosts to local machines config file.

![image](https://user-images.githubusercontent.com/76081641/130831562-152aca06-00d7-4ff5-90ac-3840e7e66c4c.png)


Visiting cms.foocorp.io

![image](https://user-images.githubusercontent.com/76081641/130831736-50e62ab4-ab5e-4764-86b4-bfa867b76645.png)

Actually achieved this also using dirb...

Can see directories using Burp Proxy as well.

Trying with dirb because burp is a PITA to set up. 





-  Target Machine `172.16.64.10` Exploitation Steps.

![nmap_scan_forthisone](https://user-images.githubusercontent.com/76081641/130801312-65e2af1f-b0f7-4a86-ba9b-c7a575763804.png)

![website](https://user-images.githubusercontent.com/76081641/130801083-ae813247-82be-4704-b8a1-722793539e75.png)

- Target machine (DNS and virtual hosts) `172.16.64.92`

![image](https://user-images.githubusercontent.com/76081641/130801964-5a56d895-0dbb-43ab-9677-4fd4251e2be6.png)

- Log in as admin:admin 

- Connect to 172.16.64.92 (DNS Server)

![image](https://user-images.githubusercontent.com/76081641/130804692-7b81d54c-6294-4d94-9b7d-8e89bbcd07a4.png)

- Open port 80 on `172.16.64.92:80`

![image](https://user-images.githubusercontent.com/76081641/130805603-f79bb5a5-06cc-4574-8318-f02e83ab7645.png)

- Dirb enumeration of the testing site.
